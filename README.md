# Winter Supplement Rules Engine

This repository contains the solution for implementing a rules engine for determining eligibility and calculating the Winter Supplement benefit.

## Table of Contents

- [Running the Rules Engine](#running-the-rules-engine)
- [Updating the MQTT Topic ID](#updating-the-mqtt-topic-id)
- [Testing the Solution](#testing-the-solution)
---

### Prerequisites

- Python 3.8+

### Setting Up the Environment
**Clone the repository**:
```bash
   git clone https://github.com/rezabanitaba/REQ117214-ISL-21R
   cd REQ117214-ISL-21R
```
1. Open the `.env` file located in the project root directory in an editor of your choice.
2. Add the MQTT topic ID to the file:

   ```plaintext
   MQTT_TOPIC_ID=<topic-id>
   ```

   ⚠️ If the web application does not publish correctly to the MQTT broker during your testing, you can use any arbitrary string for the topic ID to simulate and test locally.

3. Install dependencies:

   ```bash
   pip install -r requirements.txt
   ```

4. **Project Structure**:
   ```plaintext
   project/
   ├── rules_engine/
   │   ├── __init__.py
   │   ├── engine.py    # Core rules engine logic
   ├── tests/
   │   ├── test_engine.py   # Unit tests for rules engine
   │   ├── test_main.py     # Unit tests for MQTT integration
   ├── main.py          # Main file for the MQTT rules engine
   ├── requirements.txt # List of dependencies
   ├── .env             # Environment variables file
   ├── README.md        # Documentation
   ```

---

## Running the Rules Engine

### Start the Engine

1. Open a terminal and navigate to the project directory.
2. Run the rules engine:

   ```bash
   python main.py
   ```

   You should see:

   ```plaintext
   Connection established. Listening for incoming messages...
   ```

### Submit Data Using the Web App

1. Open the **Winter Supplement Calculator** in your browser.
2. Fill in the form and make sure the _Family Unit in Pay for December_ checkbox is checked to ensure eligibility.
3. Click "Submit".
4. The rules engine running locally should process the input data and publish results to the output topic.

   ⚠️ Note: If the web app does not correctly publish to the MQTT broker during testing, simulate the behavior locally as described in [Testing the Solution](#testing-the-solution).

---

## Updating the MQTT Topic ID

The MQTT topic ID is dynamically generated by the web app. This value must be updated in the `.env` file for each test.

1. Locate the **MQTT topic ID** displayed in the web app (e.g., `e78ffe1b-debd-4401-a886-b984a0c4b2d0`).
2. Open the `.env` file and update the value:
   ```plaintext
   MQTT_TOPIC_ID=e78ffe1b-debd-4401-a886-b984a0c4b2d0
   ```
3. Save the file and restart the rules engine:
   ```bash
   python main.py
   ```

---

## Testing the Solution

### Unit Tests

Run the unit tests to verify the rules engine and MQTT integration:

```bash
pytest --cache-clear
```

### Simulating Web App Behavior

If the web app does not function as expected, simulate its behavior using the following steps:

1. Run the rules engine in one terminal:

   ```bash
   python main.py
   ```

2. In another terminal, publish mock data to the MQTT broker by running:
   ```bash
    python publish.py
   ```
   This file publishes the sample data to the MQTT topic ID.
   ```
   test_data = {
    "id": "test123456",
    "numberOfChildren": 3,
    "familyComposition": "single",
    "familyUnitInPayForDecember": True,
     }
   ```
4. Now you can view the output provided by the engine by monitoring the terminal logs of `main.py` or by using [MQTT Explorer](https://mqtt-explorer.com/) .

---

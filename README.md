
# Winter Supplement Rules Engine

This repository contains the solution for implementing a rules engine for determining eligibility and calculating the Winter Supplement benefit.

---

## Table of Contents

1. [Prerequisites](#prerequisites)
2. [Setting Up the Environment](#setting-up-the-environment)
3. [Running the Rules Engine](#running-the-rules-engine)
4. [Updating the MQTT Topic ID](#updating-the-mqtt-topic-id)
5. [Testing the Solution](#testing-the-solution)
6. [Project Structure](#project-structure)

---

## Prerequisites

- Python 3.8+

---

## Setting Up the Environment

1. **Clone the repository**:
   ```bash
   git clone https://github.com/rezabanitaba/REQ117214-ISL-21R
   cd REQ117214-ISL-21R
   ```

2. **Activate the virtual environment**:
   - On **Windows**:
     ```bash
     .\venv\Scripts\activate
     ```
   - On **macOS/Linux**:
     ```bash
     source venv/bin/activate
     ```

3. **Edit the `.env` file**:
   - Open the `.env` file located in the project root directory in an editor of your choice.
   - Add the MQTT topic ID to the file:
     ```plaintext
     MQTT_TOPIC_ID=<topic-id>
     ```
   ⚠️ If the web application does not publish correctly to the MQTT broker during your testing, you can use any arbitrary string for the topic ID to simulate and test locally.

4. **Install dependencies**:
   ```bash
   pip install -r requirements.txt
   ```

---

## Running the Rules Engine

1. Open a terminal and navigate to the project directory.
2. Run the rules engine:
   ```bash
   python main.py
   ```

3. You should see:
   ```plaintext
   Connection established. Listening for incoming messages...
   ```

---

## Updating the MQTT Topic ID

The MQTT topic ID is dynamically generated by the web app. This value must be updated in the `.env` file for each test.

1. Locate the **MQTT topic ID** displayed in the web app (e.g., `e78ffe1b-debd-4401-a886-b984a0c4b2d0`).
2. Open the `.env` file and update the value:
   ```plaintext
   MQTT_TOPIC_ID=e78ffe1b-debd-4401-a886-b984a0c4b2d0
   ```
3. Save the file and restart the rules engine:
   ```bash
   python main.py
   ```

---

## Testing the Solution

### Unit Tests

Run the unit tests to verify the rules engine and MQTT integration:
```bash
cd tests
pytest --cache-clear
```

### Simulating Web App Behavior

If the web app does not function as expected, simulate its behavior using the following steps:

1. Run the rules engine in one terminal:
   ```bash
   python main.py
   ```

2. In another terminal, publish mock data to the MQTT broker by running:
   ```bash
   python publish.py
   ```
   This file publishes the sample data to the MQTT topic ID:
   ```plaintext
   test_data = {
       "id": "test123456",
       "numberOfChildren": 3,
       "familyComposition": "single",
       "familyUnitInPayForDecember": True,
   }
   ```

3. View the output provided by the engine by monitoring the terminal logs of `main.py` or by using [MQTT Explorer](https://mqtt-explorer.com/).

---

## Project Structure

```plaintext
project/
├── rules_engine/
│   ├── __init__.py    
│   ├── engine.py         # Rules engine implementation
├── tests/
│   ├── __init__.py
│   ├── test_engine.py    # Unit tests for rules engine
│   ├── test_mqtt.py      # Unit tests for MQTT
├── main.py               # Main file for the MQTT rules engine
├── publish.py            # Script for publishing mock data to MQTT
├── requirements.txt      # List of dependencies
├── .env                  # Environment variables
├── README.md             
```

---
